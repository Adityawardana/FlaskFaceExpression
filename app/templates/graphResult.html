{% extends "base.html" %}
{% block content %}
    <div class="ui text fdm-title container">
        <h1 class="ui header">
            Grafik Hasil Percobaan
        </h1>
    </div>

    <div class="ui container pad-tl-25">
        <button id="graph-result-btn" class="ui large primary submit button white-text" type="button">See Graph</button>
        <button id="see-all-graph-btn" class="ui large primary submit button white-text" type="button">
            <a href="{{ url_for('allGraph') }}">All Graph</a>
        </button>
    </div>

    <div id="descriptionResult" class="ui container pad-tl-25" >
        <strong>Id Session &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : </strong> 
            <span id="idSessionDescription"></span><br>
        <strong>Username &nbsp;&nbsp;&nbsp;&nbsp; : </strong> 
            <span id="userNameDescription"></span><br>
        <strong>Song &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : </strong> 
            <span id="songDescription"></span><br>   
        <strong>Kategori &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : </strong> 
            <span id="kategoriDescription"></span><br> 
    </div>

    <div id="graph-result-container" class="pad-tl-25" style="height: 400px; width:95%;">

    </div>

    <script>
        $(document).ready(function(){
            var dataGraphResult = [];
            var chart = new CanvasJS.Chart("graph-result-container", {
                zoomEnabled: true,
                animationEnabled: true,
                title: {
                    text: "Grafik Gerakan Mulut"
                },
                axisY: {
                    title: "Nilai Gerakan Mulut",
                    includeZero: true
                },
                data: [{
                    type: "splineArea",
                    color: "rgba(54,158,173,.7)",
                    dataPoints: dataGraphResult
                }]
            });

            $('#graph-result-btn').click(function() {
                $.ajax({
                    url: '/countInterest',
                    data: {

                    },
                    type: 'POST',
                    success: function(response) {
                        console.log(response.success);
                        console.log("Data Terkirim");
                        if(response.success == true){
                            var dataLength = response.dataInterestValue.length;
                            var uName = response.username;
                            var idSession = response.idSession;
                            var songList = response.dataInterestValue[0].song_list;
                            var songKategori = response.dataInterestValue[0].song_kategori;
                            var i;
                            var one = 1;

                            $('#idSessionDescription').html(idSession);
                            $('#userNameDescription').html(uName);
                            $('#songDescription').html(songList);
                            $('#kategoriDescription').html(songKategori);
                            console.log("Berhasil");
                            // console.log(i);
                            // console.log(typeof i);
                            console.log(dataLength);
                            // console.log(typeof dataLength);

                            for (i = 0; i < dataLength; i++){
                                var firstTS = response.dataInterestValue[0].ts;
                                var recentTS = response.dataInterestValue[i].ts;

                                var floatFirstTS = parseFloat(firstTS);
                                var floatRecentTS = parseFloat(recentTS);
                                var tempResultTS = floatRecentTS - floatFirstTS;
                                var resultTS = tempResultTS.toFixed(2);
                                console.log(i);

                                if(i == 0){
                                    var recentMO = response.dataInterestValue[i].mo - response.dataInterestValue[i].mo;
                                    var resultMO = parseFloat(recentMO);
                                }
                                else {
                                    var lastMO = response.dataInterestValue[i-one].mo;
                                    var recentMO = response.dataInterestValue[i].mo;
                                    var resultMO = parseFloat(recentMO) - parseFloat(lastMO);
                                }

                                dataGraphResult.push({
                                    x: Math.abs(resultTS),
                                    y: Math.abs(resultMO)
                                });
                            }
                            console.log(dataGraphResult);
                            chart.render();
                        }else{
                            console.log("Tidak Berhasil");
                        }
                    },
                    error: function(error) {
                        console.log("Data Tidak Terkirim");
                    }
                });
            });
        });
    </script>
{% endblock %}