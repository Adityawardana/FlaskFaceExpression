{% extends "base.html" %}
{% block content %}
    <div class="ui text container">
        <h1 class="ui header">
            Grafik Hasil Percobaan
        </h1>
    </div>

    <div class="ui container">
        <button id="graph-result-btn" class="ui large primary submit button white-text" type="button">See Graph</button>
    </div>

    <div id="graph-result-container">

    </div>

    <script>
        $(document).ready(function(){
            var dataGraphResult = [];
            var chart = new CanvasJS.Chart("graph-result-container", {
                title: {
                    text: "Grafik Ketertarikan User"
                },
                axisY: {
                    title: "Nilai Ketertarikan",
                    includeZero: true
                },
                data: [{
                    type: "splineArea",
                    color: "rgba(54,158,173,.7)",
                    dataPoints: dataGraphResult
                }]
            });

            $('#graph-result-btn').click(function() {
                $.ajax({
                    url: '/countInterest',
                    data: {

                    },
                    type: 'POST',
                    success: function(response) {
                        console.log(response.success);
                        console.log("Data Terkirim");
                        if(response.success == true){
                            var dataLength = response.dataInterestValue.length;
                            var i;
                            var one = 1;

                            console.log("Berhasil");
                            // console.log(i);
                            // console.log(typeof i);
                            console.log(dataLength);
                            // console.log(typeof dataLength);

                            for (i = 0; i < dataLength; i++){
                                var firstTS = response.dataInterestValue[0].ts;
                                var recentTS = response.dataInterestValue[i].ts;

                                var floatFirstTS = parseFloat(firstTS);
                                var floatRecentTS = parseFloat(recentTS);
                                var tempResultTS = floatRecentTS - floatFirstTS;
                                var resultTS = tempResultTS.toFixed(2);
                                console.log(i);

                                if(i == 0){
                                    var recentMO = response.dataInterestValue[i].mo - response.dataInterestValue[i].mo;
                                    var resultMO = parseFloat(recentMO);
                                }
                                else {
                                    var lastMO = response.dataInterestValue[i-one].mo;
                                    var recentMO = response.dataInterestValue[i].mo;
                                    var resultMO = parseFloat(recentMO) - parseFloat(lastMO);
                                }

                                dataGraphResult.push({
                                    x: Math.abs(resultTS),
                                    y: Math.abs(resultMO)
                                });
                            }
                            console.log(dataGraphResult);
                            chart.render();
                        }else{
                            console.log("Tidak Berhasil");
                        }
                    },
                    error: function(error) {
                        console.log("Data Tidak Terkirim");
                    }
                });
            });
        });
    </script>
{% endblock %}